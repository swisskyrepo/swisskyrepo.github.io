<!doctype html>
<html class="not-ready lg:text-base overflow-y-scroll scroll-pt-14" lang="en">

<head prefix="og: https://ogp.me/ns# article: https://ogp.me/ns/article#">
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="generator" content="Zola" />
  <title>Ph0wn CTF 2019 - Flag Digger | Swissky's Lab</title>
  <meta property="og:site_name" content="Swissky&apos;s Lab" />
  <meta property="og:title" content="Ph0wn CTF 2019 - Flag Digger" />
  <meta name="description" content="TLDR: It&apos;s never too late to try to solve an old challenge. This blog post is a quick writeup of a challenge from the Ph0wn CTF 2019 where you were given a small chip and you had to extract the flag fâ€¦" />
  <meta property="og:description" content="TLDR: It&apos;s never too late to try to solve an old challenge. This blog post is a quick writeup of a challenge from the Ph0wn CTF 2019 where you were given a small chip and you had to extract the flag from it" />
  <meta property="og:url" content="https://swisskyrepo.github.io/blog/ph0wn-flag-digger/" />
  <link rel="canonical" href="https://swisskyrepo.github.io/blog/ph0wn-flag-digger/" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2024-02-04T00:00:00+00:00" />
  <meta property="og:image" content="https://swisskyrepo.github.io/images/Ph0wn/ph0wn_chip_dip2deep_min.jpg" />
  <meta property="og:image:alt" content="Ph0wn CTF 2019 - Flag Digger" />
  <meta property="og:image:width" content="3072" />
  <meta property="og:image:height" content="2541" />
  <meta property="og:image:type" content="image/jpeg" />
  <link rel="alternate" type="application/atom+xml" href="https://swisskyrepo.github.io/atom.xml" title="Swissky&apos;s Lab | Atom" />
  <link rel="alternate" type="application/rss+xml" href="https://swisskyrepo.github.io/rss.xml" title="Swissky&apos;s Lab | RSS" />
  <link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed" />
  <!-- Begin Head inject -->
  
  <!-- End Head inject -->
  <link rel="stylesheet" href="https://swisskyrepo.github.io/main.min.css?h=fc65ba308cf36d3ba82c" />
  <style>
  :root{--bg: #f4f4f5; --header: #e4e4e7; color-scheme: light;}
  :root.dark{--bg: #18181b; --header: #27272a; color-scheme: dark;}
  </style>
  <meta name="theme-color" data-light="#e4e4e7" data-dark="#27272a" content="#e4e4e7" />
  <link rel="icon" type="image/x-icon" sizes="16x16" href="https://swisskyrepo.github.io/favicon.ico" />
  <link rel="apple-touch-icon" type="image/png" href="https://swisskyrepo.github.io/apple-touch-icon.png?h=58bee300054c5308feb3" />
  <link rel="icon" type="image/png" href="https://swisskyrepo.github.io/android-icon.png?h=8d80ec95446bd2c36826" />
  <script src="https://swisskyrepo.github.io/js/linkita.min.js?h=1dd3ed42fc674277bc34"></script>
  <script src="https://swisskyrepo.github.io/js/linkita-search.min.js?h=698547b4b081d012c661"></script>
  <!-- Begin Head End inject -->
  <!-- Umami analytics -->
<script defer src="https://cloud.umami.is/script.js" data-website-id="3da49f88-7825-49a6-b9cf-de0c7610e7dc"></script>

<!-- Custom CSS -->
<link rel="stylesheet" href="https://swisskyrepo.github.io/files/custom.css">

<!-- HEAD END -->
  <!-- End Head End inject -->
</head>

<body class="text-black duration-100 ease-out bg-[var(--bg)] dark:text-white">
  <!-- Header -->
<header class="bg-[var(--header)] fixed top-0 z-40 mx-auto min-h-[3.25rem] w-full header-icons">
  <div class="mx-auto w-full max-w-4xl p-2.5 lg:flex lg:justify-between">
    <div class="flex justify-between">
      <div class="flex items-center min-h-8">
        <a title="Go to home page" accesskey="!"
          href="https://swisskyrepo.github.io/" class="text-2xl font-semibold">Swissky&#x27;s Lab</a>
        <button type="button" title="Switch color scheme" accesskey="$"
          onclick="window.linkita.toggleDarkMode();" ondblclick="window.linkita.resetDarkMode();"
          class="btn-dark ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0] bg-center bg-no-repeat bg-cover dark:invert [background-image:var(--icon-theme-dark)] dark:[background-image:var(--icon-theme-light)]"
        ></button>
        <button type="button" title="Search" accesskey="/"
          onclick="window.linkita.toggleSearch();"
          class="btn-search ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0] bg-center bg-no-repeat bg-cover [background-image:var(--icon-search)] dark:invert"
        ></button>
        <script>window.linkita.initSearchButton({ scripts: ["https://swisskyrepo.github.io/elasticlunr.min.js", "https://swisskyrepo.github.io/search_index.en.js"] });</script>
      </div>
      <div title="Menu" role="button" accesskey="+" tabindex="0"
        class="btn-menu relative z-50 flex h-8 w-8 shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
        onclick="window.linkita.toggleHeaderMenu();"
        onkeydown="(event.keyCode == 13 || event.keyCode == 32) ? event.preventDefault() || window.linkita.toggleHeaderMenu() : true;"
      ></div>
    </div>
    <nav class="flex w-full items-center lg:w-auto">
      <menu
        class="nav-wrapper flex w-full flex-col py-2 lg:w-auto lg:flex-row lg:self-center lg:py-0">
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://swisskyrepo.github.io/projects"
          >Projects</a>
        </li>
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://swisskyrepo.github.io/posts"
          >Posts</a>
        </li>
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://swisskyrepo.github.io/about"
          >About</a>
        </li>
      </menu>
      <!-- Begin Header Nav inject -->
      
      <!-- End Header Nav inject -->
    </nav>
  </div>
</header>

  <!-- Begin Body Start inject -->
  
  <!-- End Body Start inject -->
  <main class="prose prose-neutral relative mx-auto min-h-[calc(100%-4rem)]
    max-w-3xl break-words px-4 pb-12 pt-28 lg:pt-32 dark:prose-invert prose-pre:rounded-lg prose-img:rounded-lg">
      <!-- Search -->
<div id="linkita-search-wrapper" class="hidden">
  <ul id="linkita-search-results"></ul>
</div>

    
<article>
  <!-- Begin Page Start inject -->
  
  <!-- End Page Start inject -->

  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">Ph0wn CTF 2019 - Flag Digger</h1>
    <!-- Page Info -->
<div class="text-sm antialiased opacity-80"><time
      datetime="2024-02-04T00:00:00+00:00">2024-02-04</time><span
        class="mx-1">&middot;</span><time
    datetime="PT0H3M0S">3&nbsp;min</time>
</div>

  </header>
  <figure class="mb-12 mt-0">
    <img
      class="h-auto w-full rounded-lg"
      src="https://swisskyrepo.github.io/images/Ph0wn/ph0wn_chip_dip2deep_min.jpg"
      alt="Ph0wn CTF 2019 - Flag Digger"
      width="3072"
      height="2541"
    />
  </figure>
  <!-- TOC -->
<div class="block-bg mb-12 rounded-lg p-2 text-lg">
  <details>
    <summary class="select-none py-0.5 lg:py-1 pl-4" accesskey="=">
      <span class="cursor-pointer">Table of Contents</span>
    </summary>
    <div class="px-2">
      <ul>
        <li>
          <a class="no-underline hover:underline" href="https://swisskyrepo.github.io/blog/ph0wn-flag-digger/#references">References</a>
        </li>
      </ul>
    </div>
  </details>
</div>

  <!-- Content -->
  <section><p>TLDR: It's never too late to try to solve an old challenge. This blog post is a quick writeup of a challenge from the Ph0wn CTF 2019 where you were given a small chip and you had to extract the flag from it.</p>
<p><img src="/images/Ph0wn/ph0wn_chip_dip2deep_min.jpg" alt="" /></p>
<span id="continue-reading"></span>
<p>A long time ago I participated in the Ph0wn CTF and we had to solve a challenge called "Flag Digger".
Unfortunately at the time I didn't have the tools and gadgets required to solve it.
But now in 2024 I recently got gifted an Hydrabus and I'm taking back my revenge ðŸ˜ˆ</p>
<p>The chip was clean and we can easily read the text on it. If you can't see it correctly, use your phone to take a picture and zoom on it or just buy a new pair of glasses ðŸ¤“. We get the following text: <strong>CSI 93C46P 0204H</strong>.</p>
<p>A simple Google search helps us identifying the chip and its pinout: <a href="https://pdf1.alldatasheet.com/datasheet-pdf/view/1715855/ETC/93C46P.html">93C46P datasheet</a></p>
<p><img src="/images/Ph0wn/datasheet-93C46P-pinout.png" alt="" /></p>
<p>From there we can deduce from the inscription "DIP2Deep", that we have to use the DIP Package.</p>
<p>Let's connect our HydraBus to the chip, we can use the command <code>show pin</code> to know where to connect <strong>CLK</strong>, <strong>SDI</strong> and <strong>SDO</strong>. More commands and details about the connection can be found in this <a href="https://github.com/hydrabus/hydrafw/wiki/HydraFW-3wire-guide">HydraFW 3wire guide</a>.</p>
<pre data-lang="ps1" style="background-color:#2b303b;color:#c0c5ce;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>screen /dev/ttyACM0
</span><span>
</span><span>&gt; </span><span style="color:#d08770;">3</span><span>-wire
</span><span>Device: threewire1
</span><span>GPIO resistor: floating
</span><span>Frequency: 1000000Hz
</span><span>Bit order: MSB first
</span><span>
</span><span>threewire1&gt; show pin 
</span><span>CLK: PB3
</span><span>SDI: PB4
</span><span>SDO: PB5
</span></code></pre>
<p><img src="/images/Ph0wn/hydrabus-pinout.png" alt="" /></p>
<p>To summarize we will connect the pins as follows:</p>
<ul>
<li>Pin 3V3: <strong>+3V</strong> (HydraBus)  -&gt; Pin 8: <strong>Vcc</strong> (Chip)</li>
<li>Pin GND: <strong>GND</strong> (HydraBus) -&gt; Pin 5: <strong>GND</strong> (Chip)</li>
<li>Pin PB4: <strong>SDI</strong> (HydraBus) -&gt; Pin 4: <strong>DO</strong> (Chip)</li>
<li>Pin PB5: <strong>SDO</strong> (HydraBus) -&gt; Pin 3: <strong>DI</strong> (Chip)</li>
<li>Pin PB3: <strong>CLK</strong> (HydraBus) -&gt; Pin 2: <strong>SK</strong> (Chip)</li>
<li>Pin PC1: <strong>CS</strong>  (HydraBus) -&gt; Pin 1: <strong>CS</strong> (Chip)</li>
</ul>
<p><img src="/images/Ph0wn/ph0wn_solve_dip2deep_min.jpg" alt="" /></p>
<p>Now we want to interact with it, a simple READ instruction will do the trick. The datasheet gave us everything we needed to know about it, it has this format:</p>
<ul>
<li>Intruction: READ</li>
<li>Start Bit: 1</li>
<li>Opcode: 10</li>
<li>Address</li>
</ul>
<p><img src="/images/Ph0wn/datasheet-93C46P-read-instruction.png" alt="" /></p>
<p>To read the content starting from address 0x000000 we will send: <code>1 10 000000</code>. Using the guide <a href="https://github.com/hydrabus/hydrafw/wiki/Bus-interaction-commands">Bus interaction commands</a>, we can craft a command to read a maximum of 255 bytes.</p>
<pre data-lang="py" style="background-color:#2b303b;color:#c0c5ce;" class="language-py "><code class="language-py" data-lang="py"><span>StartBit [Opcode Address]
</span><span style="color:#d08770;">0x1      10      000000
</span><span style="color:#d08770;">0x1      0b10000000 </span><span>= </span><span style="color:#96b5b4;">hex</span><span>(</span><span style="color:#d08770;">128</span><span>) = </span><span style="color:#d08770;">0x80
</span></code></pre>
<p>NOTE: Changing the frequency with <code>threewire1&gt; frequency 50k show</code>, didn't impact the output result.</p>
<pre data-lang="ps1" style="background-color:#2b303b;color:#c0c5ce;" class="language-ps1 "><code class="language-ps1" data-lang="ps1"><span>threewire1&gt; </span><span style="color:#d08770;">0x01 0b10000000</span><span> r:</span><span style="color:#d08770;">255
</span><span>WRITE: </span><span style="color:#d08770;">0x01</span><span> READ: </span><span style="color:#d08770;">0xFF
</span><span>WRITE: </span><span style="color:#d08770;">0x80</span><span> READ: </span><span style="color:#d08770;">0xFE
</span><span>READ: </span><span style="color:#d08770;">0x70 0x68 0x30 0x77 0x6E 0x7B 0x4D 0x40 0x73 0x74 0x33 0x72 0x30 0x66 0x33 0x77 0x69 0x72 0x65 0x4D 0x65 0x6D 0x30 0x72 0x79 0x21 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0x70 0x68 0x30 0x77 0x6E 0x7B 0x4D 0x40 0x73 0x74 0x33 0x72 0x30 0x66 0x33 0x77 0x69 0x72 0x65 0x4D 0x65 0x6D 0x30 0x72 0x79 0x21 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF
</span></code></pre>
<p>The output looks like ASCII characters, let's decode that in a Python interpreter.</p>
<pre data-lang="py" style="background-color:#2b303b;color:#c0c5ce;" class="language-py "><code class="language-py" data-lang="py"><span style="color:#b48ead;">for </span><span>c </span><span style="color:#b48ead;">in </span><span>[</span><span style="color:#d08770;">0x70</span><span>,</span><span style="color:#d08770;">0x68</span><span>,</span><span style="color:#d08770;">0x30</span><span>,</span><span style="color:#d08770;">0x77</span><span>,</span><span style="color:#d08770;">0x6E</span><span>,</span><span style="color:#d08770;">0x7B</span><span>,</span><span style="color:#d08770;">0x4D</span><span>,</span><span style="color:#d08770;">0x40</span><span>,</span><span style="color:#d08770;">0x73</span><span>,</span><span style="color:#d08770;">0x74</span><span>,</span><span style="color:#d08770;">0x33</span><span>,</span><span style="color:#d08770;">0x72</span><span>,</span><span style="color:#d08770;">0x30</span><span>,</span><span style="color:#d08770;">0x66</span><span>,</span><span style="color:#d08770;">0x33</span><span>,</span><span style="color:#d08770;">0x77</span><span>,</span><span style="color:#d08770;">0x69</span><span>,</span><span style="color:#d08770;">0x72</span><span>,</span><span style="color:#d08770;">0x65</span><span>,</span><span style="color:#d08770;">0x4D</span><span>,</span><span style="color:#d08770;">0x65</span><span>,</span><span style="color:#d08770;">0x6D</span><span>,</span><span style="color:#d08770;">0x30</span><span>,</span><span style="color:#d08770;">0x72</span><span>,</span><span style="color:#d08770;">0x79</span><span>,</span><span style="color:#d08770;">0x21</span><span>]: </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#96b5b4;">chr</span><span>(c), </span><span style="color:#bf616a;">end</span><span>=&quot;&quot;)
</span><span>ph0wn{M@st3r0f3wireMem0ry!}
</span></code></pre>
<p>Yep, that's a flag: <strong>ph0wn{M@st3r0f3wireMem0ry!}</strong></p>
<p>Since the writing of this blog post, <a href="https://twitter.com/bvernoux">bvernoux</a> added the <code>hd</code> feature in the 3-wire mode, allowing us to directly parse the hex content into string. The code has been added in this commit <a href="https://github.com/hydrabus/hydrafw/commit/a6019f4236758cf5ad19ba2d7b386f706f8cb303">a6019f4236758cf5ad19ba2d7b386f706f8cb303</a>, upgrade your HydraBus to benefit from it ðŸ¤©</p>
<pre data-lang="py" style="background-color:#2b303b;color:#c0c5ce;" class="language-py "><code class="language-py" data-lang="py"><span>threewire1&gt; </span><span style="color:#d08770;">0x01 0b10000000 </span><span>hd:</span><span style="color:#d08770;">255 
</span><span style="color:#bf616a;">WRITE</span><span>: </span><span style="color:#d08770;">0x01 0x80 
</span><span style="color:#d08770;">70 68 30 77</span><span> 6E 7B 4D </span><span style="color:#d08770;">40  73 74 33 72 30 66 33 77  </span><span>|  ph0wn{M@st3r0f3w 
</span><span style="color:#d08770;">69 72 65</span><span> 4D </span><span style="color:#d08770;">65</span><span> 6D </span><span style="color:#d08770;">30 72  79 21 </span><span style="color:#bf616a;">FF FF FF FF FF FF  </span><span>|  ireMem0ry!</span><span style="color:#d08770;">...... 
</span><span style="color:#bf616a;">FF FF FF FF FF FF FF FF  FF FF FF FF FF FF FF FF  </span><span>|  </span><span style="color:#d08770;">...............</span><span>. 
</span><span style="color:#bf616a;">FF FF FF FF FF FF FF FF  FF FF FF FF FF FF FF FF  </span><span>|  </span><span style="color:#d08770;">...............</span><span>. 
</span><span style="color:#bf616a;">FF FF FF FF FF FF FF FF  FF FF FF FF FF FF FF FF  </span><span>|  </span><span style="color:#d08770;">...............</span><span>. 
</span></code></pre>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/hydrabus/hydrafw/wiki/HydraFW-3wire-guide">hydrabus/hydrafw - HydraFW Bus 3-wire</a></li>
<li><a href="https://github.com/hydrabus/hydrafw/wiki/Bus-interaction-commands">hydrabus/hydrafw - Bus interaction commands</a></li>
<li><a href="https://github.com/ph0wn/writeups/blob/master/2019/hardware/flagdigger.md">ph0wn/writeups - Official Writeup - Flag Digger 3 Wires</a></li>
</ul>
</section>
  <hr />
  <!-- Post Taxonomies -->

  <!-- Post Nav -->
<nav class="block-bg mt-12 flex flex-wrap rounded-lg text-lg">
  <a
    class="block-hover-mask flex min-w-[50%] grow items-center rounded-l-md p-6 pr-3 font-semibold no-underline"
    href="https://swisskyrepo.github.io/blog/ssrfmap-axfr/" accesskey=","
    ><span class="mr-1.5">&#8249;</span><span>SSRFmap - Introducing the AXFR module</span></a>
  <a
    class="block-hover-mask ml-auto flex min-w-[50%] grow items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline"
    href="https://swisskyrepo.github.io/blog/drink-love-share-rump/" accesskey="."
    ><span>DLS 2024 - RedTeam Fails - &quot;Oops my bad I ruined the operation&quot;</span><span class="ml-1.5">&#8250;</span></a>
</nav>

  <!-- Begin Page End inject -->
  <!-- Share page -->
<br>

<div class="robots-nocontent social-share-buttons">
  <b>Share this content</b>
  <br>
  <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
    <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
    <a class="a2a_button_x"></a>
    <a class="a2a_button_linkedin"></a>
    <a class="a2a_button_telegram"></a>
    <a class="a2a_button_mastodon"></a>
    <a class="a2a_button_email"></a>
    <a class="a2a_button_microsoft_teams"></a>
    <a class="a2a_button_threads"></a>
    <a class="a2a_button_bluesky"></a>
    <a class="a2a_button_whatsapp"></a>
  </div>
  <br>
  <script async src="https://static.addtoany.com/menu/page.js"></script>
</div>
  <!-- End Page End inject -->
</article>

  </main>
  <!-- Footer -->
<footer class="mx-auto flex lg:mt-5 max-w-3xl flex-wrap items-center px-4 py-3 text-sm opacity-60">
  <div class="mr-auto basis-full lg:basis-1/2">
  <a href="https://creativecommons.org/licenses/by-sa/4.0/deed">Â© <time datetime="2017">2017</time> - <time datetime="2025">2025</time> Swissky</a>
  </div>
  <div class="flex basis-full lg:basis-1/2 lg:justify-end">
    <span class="mr-6 lg:ml-6">
      <a class="link" href="https://www.getzola.org/" target="_blank">Powered by Zola</a>
    </span>
    <a class="link" href="https://www.getzola.org/themes/linkita/" target="_blank">&#9998; Linkita</a>
  </div>
  <!-- Begin Footer inject -->
  
  <!-- End Footer inject -->
</footer>

  
  <!-- Begin Body End inject -->
  
  <!-- End Body End inject -->
</body>

</html>
